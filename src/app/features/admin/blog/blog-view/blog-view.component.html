<!-- Başlık -->
<div class="page-header mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
  <h2>{{ 'BLOG.TITLE' | translate }}</h2>
  <button mat-fab color="primary" (click)="goToCreate()" matTooltip="{{ 'COMMON.CREATE' | translate }}">
    <mat-icon>add</mat-icon>
  </button>
</div>

<!-- Arama ve Ekle Butonu -->
  <div class="row justify-content-center mb-3">
    <div class="col-12 col-md-8 d-flex align-items-center">
      <mat-form-field appearance="outline" class="flex-grow-1 me-2">
        <mat-label>{{ 'COMMON.SEARCH' | translate }}</mat-label>
        <input matInput type="text" [placeholder]="'BLOG.SEARCH_PLACEHOLDER' | translate" [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()" />
        <button mat-icon-button matSuffix (click)="onSearch()" [disabled]="loading">
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>

    </div>
  </div>


  <!-- Yükleniyor -->
  <div class="text-center text-muted my-3" *ngIf="loading">
    <mat-icon>hourglass_empty</mat-icon>
    <span>{{ 'COMMON.LOADING' | translate }}</span>
  </div>

  <!-- Tablo -->
  <div class="container-fluid bg-white rounded shadow-sm p-0">
    <!-- Header -->
    <div class="row fw-bold border-bottom py-2 d-none d-md-flex bg-light text-secondary">
      <div class="col-md-3 sortable" (click)="toggleSort('Title')">
        {{ 'BLOG.SORT_FIELD.TITLE' | translate }}
        <mat-icon *ngIf="orderBy === 'Title'">
          {{ orderDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
        </mat-icon>
      </div>
      <div class="col-md-2 sortable" (click)="toggleSort('CreatedAt')">
        {{ 'BLOG.SORT_FIELD.CREATED_AT' | translate }}
        <mat-icon *ngIf="orderBy === 'CreatedAt'">
          {{ orderDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
        </mat-icon>
      </div>
      <div class="col-md-2 sortable" (click)="toggleSort('AuthorFullName')">
        {{ 'BLOG.SORT_FIELD.AUTHOR' | translate }}
        <mat-icon *ngIf="orderBy === 'AuthorFullName'">
          {{ orderDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}
        </mat-icon>
      </div>
      <div class="col-md-2">{{ 'BLOG.CATEGORY' | translate }}</div>
      <div class="col-md-2">{{ 'BLOG.STATUS' | translate }}</div>
      <div class="col-md-1 text-end">{{ 'COMMON.ACTIONS' | translate }}</div>
    </div>

    <!-- Satırlar -->
    <div class="row border-bottom py-2 align-items-center" *ngFor="let post of items">
      <!-- Başlık + Kapak -->
      <div class="col-12 col-md-3 d-flex align-items-center gap-2 mb-2 mb-md-0">
        <div class="blog-thumb">
          <img *ngIf="post.coverImageUrl && !post._imgErr" [src]="post.coverImageUrl" [alt]="post.title"
            (error)="onImgError(post)" />
          <mat-icon *ngIf="!post.coverImageUrl || post._imgErr">image</mat-icon>
        </div>
        <div>
          <div class="fw-semibold">{{ post.title }}</div>
          <div class="text-muted small">{{ post.content | slice:0:60 }}…</div>
        </div>
      </div>

      <!-- Tarih -->
      <div class="col-6 col-md-2">
        {{ post.createdAt | date: 'dd MMMM yyyy' : undefined : i18n.currentLang }}
      </div>

      <!-- Yazar -->
      <div class="col-6 col-md-2">
        {{ post.authorFullName }}
      </div>

      <!-- Kategori -->
      <div class="col-6 col-md-2">
        {{ post.categoryName || '—' }}
      </div>

      <!-- Durum -->
      <div class="col-6 col-md-2">
        <span class="badge px-3 py-2" [ngClass]="post.isPublished ? 'bg-success' : 'bg-secondary'">
          {{ post.isPublished ? ('BLOG.STATUS_PUBLISHED' | translate) : ('BLOG.STATUS_DRAFT' | translate) }}
        </span>
      </div>

      <!-- Aksiyonlar -->
      <div class="col-12 col-md-1 text-md-end text-start mt-2 mt-md-0">
        <button mat-icon-button [matMenuTriggerFor]="rowMenu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #rowMenu="matMenu">
          <button mat-menu-item (click)="open(post)">
            <mat-icon>open_in_new</mat-icon>
            <span>{{ 'COMMON.OPEN' | translate }}</span>
          </button>
          <button mat-menu-item (click)="edit(post)">
            <mat-icon>edit</mat-icon>
            <span>{{ 'COMMON.EDIT' | translate }}</span>
          </button>
          <button mat-menu-item (click)="remove(post.id)" [disabled]="loading">
            <mat-icon color="warn">delete</mat-icon>
            <span>{{ 'COMMON.DELETE' | translate }}</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </div>

  <!-- Boş durum -->
  <div class="text-center text-muted my-4" *ngIf="!items?.length && !loading">
    <mat-icon>hourglass_empty</mat-icon>
    <p>{{ 'EMPTY.NO_RECORDS' | translate }}</p>
  </div>

  <!-- Sayfalama -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-3">
    <div class="mb-2 mb-md-0 d-flex align-items-center">
      <span>{{ 'COMMON.ITEMS_PER_PAGE' | translate }}</span>
      <mat-form-field appearance="fill" class="ms-2" style="width:80px">
        <mat-select [(value)]="pageable.pageSize" (selectionChange)="onPageSizeChange()">
          <mat-option [value]="5">5</mat-option>
          <mat-option [value]="10">10</mat-option>
          <mat-option [value]="20">20</mat-option>
          <mat-option [value]="50">50</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div>
      <span>{{ pageable.rangeStart }}–{{ pageable.rangeEnd }} {{ 'COMMON.OF' | translate }} {{ pageable.totalCount
        }}</span>
    </div>

    <div class="mt-2 mt-md-0">
      <button mat-icon-button (click)="pageable.goFirst(); load()" [disabled]="loading || pageable.pageNumber<=1">
        <mat-icon>first_page</mat-icon>
      </button>
      <button mat-icon-button (click)="pageable.goPrev(); load()" [disabled]="loading || pageable.pageNumber<=1">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button mat-icon-button (click)="pageable.goNext(); load()"
        [disabled]="loading || pageable.pageNumber>=pageable.totalPages">
        <mat-icon>chevron_right</mat-icon>
      </button>
      <button mat-icon-button (click)="pageable.goLast(); load()"
        [disabled]="loading || pageable.pageNumber>=pageable.totalPages">
        <mat-icon>last_page</mat-icon>
      </button>
    </div>
  </div>