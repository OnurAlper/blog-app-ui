<!-- Sade başlık -->
<div class="page-header">
  <h2>{{ 'BLOG.TITLE' | translate }}</h2>
</div>

<!-- Arama -->
<div class="search-wrap">
  <mat-form-field appearance="outline" class="search-field">
    <mat-label>{{ 'COMMON.SEARCH' | translate }}</mat-label>
    <input
      matInput
      type="text"
      [placeholder]="'BLOG.SEARCH_PLACEHOLDER' | translate"
      [(ngModel)]="searchTerm"
      (keyup.enter)="onSearch()"
      [attr.aria-label]="'COMMON.SEARCH' | translate"
    />
    <button
      mat-icon-button
      matSuffix
      (click)="onSearch()"
      [disabled]="loading"
      [attr.aria-label]="'COMMON.SEARCH' | translate"
    >
      <mat-icon>search</mat-icon>
    </button>
  </mat-form-field>
</div>

<!-- Yükleniyor -->
<div class="loading-row" *ngIf="loading">
  <mat-icon>hourglass_empty</mat-icon>
  <span>{{ 'COMMON.LOADING' | translate }}</span>
</div>

<!-- Tablo görünümlü liste (kapaklı) -->
<div class="table-card">
  <!-- Başlık satırı -->
  <div class="table-row table-header">
    <div class="cell col-cover"></div>
    <div class="cell col-title sortable" (click)="toggleSort('Title')">
      {{ 'BLOG.SORT_FIELD.TITLE' | translate }}
      <mat-icon *ngIf="orderBy==='Title'">{{ orderDirection==='asc' ? 'north' : 'south' }}</mat-icon>
    </div>
    <div class="cell col-date sortable" (click)="toggleSort('CreatedAt')">
      {{ 'BLOG.SORT_FIELD.CREATED_AT' | translate }}
      <mat-icon *ngIf="orderBy==='CreatedAt'">{{ orderDirection==='asc' ? 'north' : 'south' }}</mat-icon>
    </div>
    <div class="cell col-author sortable" (click)="toggleSort('authorFullName')">
      {{ 'BLOG.SORT_FIELD.AUTHOR' | translate }}
      <mat-icon *ngIf="orderBy==='authorFullName'">{{ orderDirection==='asc' ? 'north' : 'south' }}</mat-icon>
    </div>
    <div class="cell col-category">{{ 'BLOG.CATEGORY' | translate }}</div>
    <div class="cell col-status">{{ 'BLOG.STATUS' | translate }}</div>
    <div class="cell col-actions"></div>
  </div>

  <!-- Kayıtlar -->
  <ng-container *ngIf="items?.length; else emptyState">
    <div class="table-row" *ngFor="let post of items">
      <!-- Kapak -->
      <div class="cell col-cover">
        <div class="thumb">
          <ng-container *ngIf="!post._imgErr && post.coverImageUrl; else thumbFallback">
            <img
              [src]="post.coverImageUrl"
              [alt]="post.title"
              loading="lazy"
              (error)="onImgError(post)"
            />
          </ng-container>
          <ng-template #thumbFallback>
            <div class="thumb-placeholder">
              <mat-icon>image</mat-icon>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Başlık & kısa özet -->
      <div class="cell col-title">
        <div class="title line-clamp-1">{{ post.title }}</div>
        <div class="excerpt line-clamp-1">
          {{ (post.content || '') | slice:0:120 }}
          <span *ngIf="(post.content?.length || 0) > 120">…</span>
        </div>
      </div>

      <!-- Tarih -->
      <div class="cell col-date">
        {{ post.createdAt | date: 'mediumDate' }}
      </div>

      <!-- Yazar -->
      <div class="cell col-author">
        {{ post.authorFullName }}
      </div>

      <!-- Kategori -->
      <div class="cell col-category">
        <span *ngIf="post.categoryName; else noCat">{{ post.categoryName }}</span>
        <ng-template #noCat>—</ng-template>
      </div>

      <!-- Durum -->
      <div class="cell col-status">
        <span class="status-pill" [class.published]="post.isPublished" [class.unpublished]="!post.isPublished">
          <mat-icon class="status-icon">{{ post.isPublished ? 'public' : 'visibility_off' }}</mat-icon>
          {{ post.isPublished ? ('BLOG.STATUS_PUBLISHED' | translate) : ('BLOG.STATUS_DRAFT' | translate) }}
        </span>
      </div>

      <!-- Aksiyonlar -->
      <div class="cell col-actions">
        <button mat-icon-button [matMenuTriggerFor]="rowMenu" [attr.aria-label]="'COMMON.MORE' | translate">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #rowMenu="matMenu">
          <button mat-menu-item (click)="open(post)">
            <mat-icon>open_in_new</mat-icon>
            <span>{{ 'COMMON.OPEN' | translate }}</span>
          </button>
          <button mat-menu-item (click)="edit(post)">
            <mat-icon>edit</mat-icon>
            <span>{{ 'COMMON.EDIT' | translate }}</span>
          </button>
          <button mat-menu-item (click)="remove(post.id)" [disabled]="loading">
            <mat-icon color="warn">delete</mat-icon>
            <span>{{ 'COMMON.DELETE' | translate }}</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </ng-container>

  <!-- Boş durum -->
  <ng-template #emptyState>
    <div class="empty">
      <mat-icon>hourglass_empty</mat-icon>
      <p>{{ 'EMPTY.NO_RECORDS' | translate }}</p>
    </div>
  </ng-template>
</div>

<!-- Sayfalama -->
<div class="paginator paginator--mat" *ngIf="totalPages && totalPages >= 1">
  <!-- LEFT: Items per page -->
  <div class="pag-left">
    <span class="label">{{ 'COMMON.ITEMS_PER_PAGE' | translate }}</span>
      <mat-form-field appearance="fill"
                  class="page-size page-size--underline">
    <mat-select [(value)]="pageSize" (selectionChange)="onPageSizeChange()">
      <mat-option [value]="5">5</mat-option>
      <mat-option [value]="10">10</mat-option>
      <mat-option [value]="20">20</mat-option>
      <mat-option [value]="50">50</mat-option>
    </mat-select>
  </mat-form-field>
  </div>

  <!-- CENTER: 1–10 of 4861 -->
  <div class="pag-center">
    <span class="range">
      {{ rangeStart }}–{{ rangeEnd }} {{ 'COMMON.OF' | translate }} {{ totalCount }}
    </span>
  </div>

  <!-- RIGHT: arrows -->
  <div class="pag-right">
    <button mat-icon-button (click)="goFirst()" [disabled]="loading || pageNumber<=1"
            [attr.aria-label]="'COMMON.FIRST' | translate">
      <mat-icon>first_page</mat-icon>
    </button>
    <button mat-icon-button (click)="goPrev()" [disabled]="loading || pageNumber<=1"
            [attr.aria-label]="'COMMON.PREV' | translate">
      <mat-icon>chevron_left</mat-icon>
    </button>
    <button mat-icon-button (click)="goNext()" [disabled]="loading || pageNumber>=totalPages"
            [attr.aria-label]="'COMMON.NEXT' | translate">
      <mat-icon>chevron_right</mat-icon>
    </button>
    <button mat-icon-button (click)="goLast()" [disabled]="loading || pageNumber>=totalPages"
            [attr.aria-label]="'COMMON.LAST' | translate">
      <mat-icon>last_page</mat-icon>
    </button>
  </div>
</div>

